<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Kredensial BMU</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 8px 15px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; border: none; border-radius: 4px; }
        .btn-success { background: #28a745; color: white; border: none; border-radius: 4px; }
        .btn-warning { background: #ffc107; color: black; border: none; border-radius: 4px; }
        .btn-danger { background: #dc3545; color: white; border: none; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test Sistem Kredensial BMU</h1>
    
    <div class="test-section">
        <h3>1. Test Kredensial Default</h3>
        <button class="btn-primary" onclick="testDefaultCredentials()">Test Default Login</button>
        <div id="defaultResult"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Tambah Kredensial Baru</h3>
        <input type="text" id="testUsername" placeholder="Username" value="TestUser123">
        <input type="password" id="testPassword" placeholder="Password" value="TestPass123">
        <button class="btn-success" onclick="addTestCredential()">Tambah Kredensial</button>
        <div id="addResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Test Login dengan Kredensial Baru</h3>
        <button class="btn-primary" onclick="testNewCredential()">Test New Login</button>
        <div id="newResult"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Lihat Semua Kredensial</h3>
        <button class="btn-warning" onclick="showAllCredentials()">Tampilkan Kredensial</button>
        <div id="credentialsList"></div>
    </div>
    
    <div class="test-section">
        <h3>5. Reset Kredensial</h3>
        <button class="btn-danger" onclick="resetAllCredentials()">Reset ke Default</button>
        <div id="resetResult"></div>
    </div>

    <script>
        // Copy functions from BMU scripts
        function getStoredCredentials() {
            const stored = localStorage.getItem('bmu_credentials');
            if (stored) {
                try {
                    const credentials = JSON.parse(stored);
                    return credentials.map(cred => ({
                        username: cred.username,
                        password: cred.password,
                        createdAt: cred.createdAt || new Date().toISOString(),
                        createdBy: cred.createdBy || 'System',
                        isDefault: cred.isDefault || false
                    }));
                } catch (e) {
                    console.error('Error parsing stored credentials:', e);
                }
            }
            
            const defaultCreds = [{
                username: 'BMU-Madiun08',
                password: 'BMU-Madiun08',
                createdAt: new Date().toISOString(),
                createdBy: 'System',
                isDefault: true
            }];
            
            saveCredentials(defaultCreds);
            return defaultCreds;
        }

        function saveCredentials(credentials) {
            localStorage.setItem('bmu_credentials', JSON.stringify(credentials));
        }

        function login(username, password) {
            const credentials = getStoredCredentials();
            
            console.log('Login attempt:', { username, password: '***' });
            console.log('Available credentials:', credentials.map(c => ({ username: c.username, password: '***' })));
            
            const validCredential = credentials.find(cred => 
                cred.username === username && cred.password === password
            );
            
            if (validCredential) {
                console.log('Login successful for:', username);
                return true;
            }
            
            console.log('Login failed for:', username);
            return false;
        }

        // Test functions
        function testDefaultCredentials() {
            const result = document.getElementById('defaultResult');
            const success = login('BMU-Madiun08', 'BMU-Madiun08');
            
            if (success) {
                result.innerHTML = '<p class="success">‚úÖ Default credentials working!</p>';
            } else {
                result.innerHTML = '<p class="error">‚ùå Default credentials failed!</p>';
            }
        }

        function addTestCredential() {
            const username = document.getElementById('testUsername').value;
            const password = document.getElementById('testPassword').value;
            const result = document.getElementById('addResult');
            
            if (!username || !password) {
                result.innerHTML = '<p class="error">‚ùå Username dan password harus diisi!</p>';
                return;
            }
            
            const credentials = getStoredCredentials();
            
            if (credentials.some(cred => cred.username === username)) {
                result.innerHTML = '<p class="error">‚ùå Username sudah ada!</p>';
                return;
            }
            
            const newCredential = {
                username: username,
                password: password,
                createdAt: new Date().toISOString(),
                createdBy: 'Test',
                isDefault: false
            };
            
            credentials.push(newCredential);
            saveCredentials(credentials);
            
            // Verify
            const verifyCredentials = getStoredCredentials();
            const savedCredential = verifyCredentials.find(cred => cred.username === username);
            
            if (savedCredential) {
                result.innerHTML = `<p class="success">‚úÖ Kredensial berhasil ditambahkan!<br>Username: ${username}<br>Password: ${password}</p>`;
            } else {
                result.innerHTML = '<p class="error">‚ùå Gagal menyimpan kredensial!</p>';
            }
        }

        function testNewCredential() {
            const username = document.getElementById('testUsername').value;
            const password = document.getElementById('testPassword').value;
            const result = document.getElementById('newResult');
            
            if (!username || !password) {
                result.innerHTML = '<p class="error">‚ùå Username dan password harus diisi!</p>';
                return;
            }
            
            const success = login(username, password);
            
            if (success) {
                result.innerHTML = `<p class="success">‚úÖ Login berhasil dengan kredensial baru!<br>Username: ${username}</p>`;
            } else {
                result.innerHTML = `<p class="error">‚ùå Login gagal dengan kredensial baru!<br>Username: ${username}</p>`;
            }
        }

        function showAllCredentials() {
            const credentials = getStoredCredentials();
            const result = document.getElementById('credentialsList');
            
            let html = `<p class="info">üìã Total kredensial: ${credentials.length}</p>`;
            html += '<pre>' + JSON.stringify(credentials, null, 2) + '</pre>';
            
            result.innerHTML = html;
        }

        function resetAllCredentials() {
            const result = document.getElementById('resetResult');
            
            if (confirm('Reset semua kredensial ke default?')) {
                localStorage.removeItem('bmu_credentials');
                
                const defaultCreds = [{
                    username: 'BMU-Madiun08',
                    password: 'BMU-Madiun08',
                    createdAt: new Date().toISOString(),
                    createdBy: 'System',
                    isDefault: true
                }];
                
                saveCredentials(defaultCreds);
                
                result.innerHTML = '<p class="success">‚úÖ Kredensial berhasil direset ke default!</p>';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            showAllCredentials();
        });
    </script>
</body>
</html>